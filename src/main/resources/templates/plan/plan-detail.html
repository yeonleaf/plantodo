<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <!--Bootstrap - required meta tags-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--Bootstrap CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/js/my.js"></script>
</head>
<body>
<!--제목-->
<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header th:replace="fragments/common :: fragment-header"></header>

    <div class="container">
        <div class="row mx-2 my-2">
            <span th:if="${plan.dtype.equals('Term')}" class="col d-flex justify-content-start"><span th:text="${plan.startDate}"></span>~<span th:text="${plan.endDate}"></span></span>
            <span th:if="${plan.dtype.equals('Regular')}" class="col d-flex justify-content-start">상시(시작일 : <span th:text="${plan.startDate}"></span> )</span>
            <span th:text="${plan.planStatus}" class="col d-flex justify-content-end"></span>
        </div>
        <div class="row mx-2 my-2">
            <p th:text="${plan.title}" class="fs-3"></p>
        </div>
    </div>
    <div class="container">
        <div class="d-flex justify-content-end">
            <div class="btn-group" role="group" area-label="Basic example">
                <form th:action="@{/plan}" method="post">
                    <input type="hidden" name="planId" th:value="${plan.id}">
                    <input type="hidden" name="_method" value="DELETE"/>
                    <button type="submit" class="btn btn-primary">DELETE</button>
                </form>
                <div th:if="${!plan.planStatus.toString().equals('PAST')}" class="btn-group" role="group" area-label="Basic example">
                    <form th:action="@{/plan/switching}" method="post">
                        <input type="hidden" name="planId" th:value="${plan.id}">
                        <input type="hidden" name="_method" value="PUT"/>
                        <button type="submit" class="btn btn-primary">SWITCH</button>
                    </form>
                    <form th:action="@{/plan/type/{planId}(planId=${plan.id})}" method="get">
                        <button type="submit" class="btn btn-primary">UPDATE</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!--날짜로 검색-->
    <div class="container">
        <div class="m-3">
            <form th:action="@{/plan/filtering}" th:object="${dateSearchForm}" method="post">
                <input type="hidden" name="planId" th:value="${plan.id}">
                <div class="row mx-2 my-2">
                    <label for="startDate" class="form-label">시작일</label>
                    <input type="date" id="startDate" name="startDate" th:value="${dateSearchForm.startDate}" class="form-control">
                    <div th:errors="*{startDate}" class="text-danger"></div>
                </div>

                <div class="row mx-2 my-2">
                    <label for="startDate" class="form-label">종료일</label>
                    <input type="date" id="endDate" name="endDate" th:value="${dateSearchForm.endDate}" class="form-control">
                    <div th:errors="*{endDate}" class="text-danger"></div>
                </div>

                <div class="row mx-2 my-2">
                    <input type="submit" class="btn btn-sm btn-secondary" th:value="검색">
                </div>
            </form>
        </div>
    </div>

    <!--to-do 목록 출력-->
    <div class="container">
        <div th:each="todo : ${todosByPlanId}" class="row mx-1 my-1 bg-danger">
            <a th:attr="onclick=|getButtonBlock('${plan.id}','${todo.id}')|" th:text="${todo.title}"></a>
            <!--매일반복-->
                <span th:if="${todo.repOption==0}" th:text="'매일반복'"></span>
            <!--요일반복-->
                <span th:if="${todo.repOption==1}" th:text="'요일반복'"></span>
                <span th:if="${todo.repOption==1}" th:each="repVal : ${todo.repValue}">
                        <span th:text="${repVal}"></span>
                </span>
                <span th:if="${todo.repOption==1}">요일마다</span>
            <!--기간반복-->
                <span th:if="${todo.repOption==2}" th:text="'기간반복'"></span>
                <span th:if="${todo.repOption==2}" th:text="${todo.repValue.get(0)+'일마다'}"></span>
            <!--삭제 / 수정 버튼-->
            <div id="ButtonBlock"></div>
        </div>
    </div>
    <!--일자별 to-do-Date 출력-->
    <div class="container">
        <div th:each="entry : ${allToDatesByDate}" class="row mx-2 my-2">
            <p th:text="${entry.key}" class="fs-5"></p>
            <div th:each="todoDate : ${entry.value}">
                <div th:id="${todoDate.id}" class="container">
                    <div class="row mx-1 my-1">
                        <div th:id="${'titleBox'+todoDate.id}" class="col-10">
                            <input type="checkbox" th:if=${todoDate.getDtype.toString().equals("Rep")} th:id="${todoDate.id}" th:name="${todoDate.id}" th:value="${todoDate.id}" th:attr="onclick=|switchTodoDateStatus(${todoDate.id})|" th:checked="${todoDate.todoStatus.toString().equals('CHECKED')}" th:disabled="${entry.key.isBefore(today)}" class="form-check-input">
                            <input type="checkbox" th:if=${todoDate.getDtype.toString().equals("Daily")} th:id="${todoDate.id}" th:name="${todoDate.id}" th:value="${todoDate.id}" th:attr="onclick=|switchTodoDateStatus(${todoDate.id})|" th:checked="${todoDate.todoStatus.toString().equals('CHECKED')}" th:disabled="${entry.key.isBefore(today)}" class="form-check-input">
                            <span><input id="blockTrigger" type="button" th:selectedDate="${entry.key}" th:todoDateId="${todoDate.id}" th:value="${todoDate.title}" class="btn btn-sm btn-link"></span>
                        </div>
                        <div class="col-2">
                            <div class="btn-group" role="group" area-label="Basic example">
                                <form th:if="${entry.key.isAfter(today) || entry.key.isEqual(today)}" th:id="${'deleteForm'+todoDate.id}">
                                    <input type="hidden" name="pageInfo" value="home">
                                    <input type="hidden" name="selectedDate" th:value="${entry.key}">
                                    <input type="hidden" name="planId" th:value="${plan.id}">
                                    <input type="hidden" name="todoDateId" th:value="${todoDate.id}">
                                    <input type="hidden" name="_method" value="DELETE">
                                    <button type="button" th:attr="onclick=|deleteTodoDate(${todoDate.id})|" class="btn btn-primary btn-sm">DEL</button>
                                </form>
                                <button th:if="${entry.key.isAfter(today) || entry.key.isEqual(today)}" type="button" th:attr="onclick=|getTodoDateEditForm('home', '${entry.key}', '${plan.id}', '${todoDate.id}')|" class="btn btn-primary btn-sm">EDT</button>
                            </div>
                        </div>
                    </div>
                    <div class="row mx-3 my-3">
                        <div class="col-1"></div>
                        <div th:id="${'detailBlock'+todoDate.id}" state="un-clicked" class="col"></div>
                        <div class="col-1"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--홈으로 돌아가기-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>