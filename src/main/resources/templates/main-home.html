<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <!--Bootstrap - required meta tags-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--Bootstrap CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <div th:replace="/fragments/header.html :: fragment-header"></div>
    <script async src="/js/jquery-3.6.0.min.js"></script>
    <script async src="/js/my.js"></script>
</head>
<body>
<div th:replace="/fragments/nav.html :: fragment-nav"></div>

<form th:action="@{/home}" th:object="${calendarSearchForm}" method="post">
    <input type="text" id="targetYear" name="targetYear" th:value="*{targetYear}">년
    <input type="text" id="targetMonth" name="targetMonth" th:value="*{targetMonth}">월
    <input type="submit" value="검색">
</form>
<caption th:text="${calendarSearchForm.targetMonth}"></caption>월
<table>
    <tr>
        <th>월</th>
        <th>화</th>
        <th>수</th>
        <th>목</th>
        <th>금</th>
        <th>토</th>
        <th>일</th>
    </tr>
    <tr th:each="calrow : ${calendar}">
        <th th:each="eachDate : ${calrow}">
            <span th:if="${eachDate == null}"> </span>
            <button th:if="${eachDate != null}" id = "eachDate" th:attr="onclick=|loadDateBlockData('${eachDate}')|" th:text="${eachDate.getDayOfMonth()}" th:value="${eachDate.getDayOfMonth()}"></button>
        </th>
    </tr>
</table>
<div id="dateBlock">
    <th:block id="selectedDate" th:if="${selectedDate != null}" th:text="${selectedDate}" th:value="${selectedDate}"></th:block>

    <th:block th:if="${dateBlockData != null}">
        <div th:each="entry : ${dateBlockData}">
            <button th:attr="onclick=|getTodoDateRegisterForm(${entry.key.id})|" th:text="${entry.key.title}"></button>
            <div th:id="${'dailyTdRegister'+entry.key.id}" style="display: none;">
                <form th:if="${!entry.key.planStatus.toString().equals('DELETED')}" th:id="${'dailyTdRegisterForm'+entry.key.id}">
                    <input type="hidden" id="selectedDailyDate" name="selectedDailyDate" th:value="${selectedDate}">
                    <input type="hidden" id="planId" name="planId" th:value="${entry.key.id}">
                    <input type="text" id="title" name="title"/>
                    <input type="button" id="tdSubmit" name="tdSubmit" value="submit" th:attr="onclick=|registerTodoDateDaily(${entry.key.id})|">
                </form>
            </div>
            <div th:each="todoDate : ${entry.value}">
                <div th:id="${todoDate.id}">
                    <div th:id="${'titleBox'+todoDate.id}">
                        <input type="checkbox" th:if=${todoDate.getDtype.toString().equals("Rep")} th:id="${todoDate.id}" th:name="${todoDate.id}" th:value="${todoDate.id}" th:attr="onclick=|switchTodoDateStatus(${todoDate.id})|" th:checked="${todoDate.todoStatus.toString().equals('CHECKED')}" th:disabled="${selectedDate.isBefore(today) or todoDate.todo.plan.planStatus.toString().equals('PAST')}">
                        <input type="checkbox" th:if=${todoDate.getDtype.toString().equals("Daily")} th:id="${todoDate.id}" th:name="${todoDate.id}" th:value="${todoDate.id}" th:attr="onclick=|switchTodoDateStatus(${todoDate.id})|" th:checked="${todoDate.todoStatus.toString().equals('CHECKED')}" th:disabled="${selectedDate.isBefore(today) or todoDate.plan.planStatus.toString().equals('PAST')}">

                        <span><a th:attr="onclick=|getTodoDateDetailBlock('${selectedDate}','${todoDate.id}')|" th:text="${todoDate.title}"></a></span>
                    </div>

                    <span id="delete-box">
                        <form th:if="${selectedDate.isAfter(today) || selectedDate.isEqual(today)}" th:id="${'deleteForm'+todoDate.id}">
                            <input type="hidden" name="pageInfo" value="home">
                            <input type="hidden" name="selectedDate" th:value="${selectedDate}">
                            <input type="hidden" name="planId" th:value="${entry.key.id}">
                            <input type="hidden" name="todoDateId" th:value="${todoDate.id}">
                            <input type="hidden" name="_method" value="DELETE">
                            <input type="button" value="DEL" th:attr="onclick=|deleteTodoDate(${todoDate.id})|">
                        </form>
                    </span>

                    <input type="button" value="EDT" th:attr="onclick=|getTodoDateEditForm('home', '${selectedDate}', '${entry.key.id}', '${todoDate.id}')|">

                    <div th:id="${'detailBlock'+todoDate.id}" state="un-clicked"></div>

                    <div th:if="${selectedDate.isAfter(today) || selectedDate.isEqual(today)}" th:id="${'comment-register-box'+todoDate.id}" style="display: none;">
                        <form id="comment-form">
                            <input type="hidden" id="selectedDate" name="selectedDate" th:value="${selectedDate}">
                            <input type="hidden" id="todoDateId" name="todoDateId" th:value="${todoDate.id}">
                            <input type="text" id="comment" name="comment" >
                            <button id="write" name="write" type="submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </th:block>
</div>

<a href="/plan/type">PLAN REGISTER</a>
<a href="/plan/plans">MY PLANS</a>
<a href="/todo/register">TODO REGISTER</a>
<footer th:replace="/fragments/footer.html :: fragment-footer"></footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>